---
import { UAPA_CONFIG, formatAuthors } from '../config/uapa-config.ts';

export interface Props {
  showCuaedSection?: boolean;
  showToolsMenu?: boolean;
  showCreditsModal?: boolean;
  uapaTitle?: string;
  authorName?: string;
}

const { 
  showCuaedSection = UAPA_CONFIG.footer.showCuaedSection,
  showToolsMenu = UAPA_CONFIG.footer.showToolsMenu,
  showCreditsModal = UAPA_CONFIG.footer.showCreditsModal,
  uapaTitle = UAPA_CONFIG.title,
  authorName = formatAuthors.display
} = Astro.props;

const credits = UAPA_CONFIG.footer.credits;
const toolsMenu = UAPA_CONFIG.footer.toolsMenu;

// Función para formatear nombres con saltos de línea en los créditos
// Ejemplo: "Autor 1, Autor 2, Autor 3" → "Autor 1<br>Autor 2<br>Autor 3"
const formatNamesWithBreaks = (names: string) => {
  if (!names || names.trim() === "") return "";
  const nameArray = names.split(",").map(n => n.trim()).filter(n => n !== "");
  return nameArray.join("<br>");
};
---

<!-- ************* INICIA FOOTER ************** -->
<footer>
  <div class="container">
    <div class="row">
      <!-- contenido -->
      
      <div class="col-xs-12 col-sm-12 col-lg-3">
        <!-- Solo mostrar en modo CUAED -->
        {showCuaedSection && (
          <Fragment>
            <h2 class="text-center text-lg-start">Desarrollado por:</h2>
            <a class="d-block link-cuaieed mx-auto mx-lg-0 mb-5 " href="https://cuaed.unam.mx/" target="_blank"
              title="CUAED" aria-label="CUAED"><img class="img-fluid" id="cuaieedlogo" src="img/logo_cuaed.png"
                alt=""></a>
          </Fragment>
        )}
      </div>

      <div class="col-xs-12 col-sm-12 col-lg-6">

        <!-- Solo mostrar en modo CUAED -->
        {showCuaedSection && (
          <Fragment>
            <h2 class="text-center text-lg-start">Aviso legal</h2>
            <p>Coordinación de Universidad Abierta y Educación Digital de la UNAM. ©Todos los
              derechos reservados 2025. Hecho en México. Este sitio puede ser reproducido con fines no lucrativos, siempre
              y cuando no se mutile, se cite la fuente completa y su dirección electrónica, de otra forma, se requiere
              permiso previo por escrito de la Institución.</p>
            <p>Al navegar en este sitio, encontrará contenidos diseñados por académicos de la UNAM, denominados Recursos
              Educativos Abiertos (REA), disponibles para todo el público en forma gratuita. Los contenidos de cada REA
              son responsabilidad exclusiva de sus autores, y de las entidades académicas a las que están adscritos
              quienes los desarrollan. Asimismo, los REA no tienen impedimento en materia de propiedad intelectual; ni
              contienen información que por su naturaleza pueda considerarse confidencial y reservada.
            </p>
            <p>Los REA podrán ser utilizados sin fines de lucro, citando invariablemente la fuente y sin alterar la obra,
              respetando los términos institucionales de uso y los derechos de propiedad intelectual de terceros. Si desea
              más información, escriba a proyectos@cuaed.unam.mx</p>
          </Fragment>
        )}

        <!-- Solo mostrar en modo CUAED -->
        {showCuaedSection && (
          <div id="creative-commons">
            <hr aria-hidden="true" class="my-4">
            <a class="link-creative d-block mx-auto mx-lg-0" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"
              target="_blank" aria-hidden="true"> <img src="img/licencia_cc.svg" class="img-fluid w-100" alt=""></a>
            <p class="mt-4">{uapaTitle} por {authorName} se distribuye bajo una <a
                class="footer-link btn-link" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"
                target="_blank">Licencia Creative Commons
                Atribución-NoComercial-SinDerivadas 4.0 Internacional.</a>
            </p>      
          </div>
        )}

        <!-- Sección Universia - Solo cuando NO es CUAED -->
        {!showCuaedSection && (
          <div id="universia">
            <hr aria-hidden="true" class="my-4">
            <div class="d-flex justify-content-center align-items-center">
              <a href="https://www.universia.net/mx/home.html" target="_blank">
                <img id="universialogo" src="https://repositorio-uapa.cuaed.unam.mx/repositorio/uapa/img/universia.png" width="220px"
                  height="auto">
              </a>
            </div>
          </div>
          <!--Poner CUAED-->
          <script is:inline src="https://repositorio-uapa.cuaed.unam.mx/repositorio/uapa/js/jquery-3.6.0.min.js"></script>
          <script is:inline src="https://repositorio-uapa.cuaed.unam.mx/repositorio/uapa/js/footer2024.js"></script>
          <script is:inline>
            if (typeof textoFooter === 'function') {
              textoFooter(false);
            }
          </script>
        )}
      </div>

      {showCreditsModal && (
        <div class="col-xs-12 col-sm-12 col-lg-3 d-flex justify-content-center align-items-start pt-4 pt-lg-0">
          <!-- Button trigger modal -->
          <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#creditos">
            Créditos
          </button>

          <!-- Modal -->
          <div class="modal fade" id="creditos" tabindex="-1" aria-labelledby="creditosLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h1 class="modal-title fs-6" id="creditosLabel">Créditos</h1>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                  <ul class="container-fluid">
                    {credits.map((credit) => (
                      <li class="row">
                        <div class="col-xs-12 col-sm-12 col-lg-6">
                          <p class="mb-0">{credit.role}</p>
                        </div>
                        <div class="col-xs-12 col-sm-12 col-lg-6">
                          <p class="mb-0" set:html={formatNamesWithBreaks(credit.name)}></p>
                        </div>
                      </li>
                    ))}
                  </ul>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cerrar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

    </div>
  </div>
</footer>

{showToolsMenu && (
  <Fragment>
    <!--***********************Menú lateral flotante***********************-->
    <!-- tools -->
    <div id="tools">
      <a data-bs-toggle="modal" data-bs-target="#foro"> <img src="img/foro.svg" alt="foro" width="50" height="50" 
         data-toggle="tooltip" data-placement="top" title="Foro"></a> 
      
      <a data-bs-toggle="modal" data-bs-target="#evalua"> <img src="img/evalua.svg" alt="evalua-la-uapa" width="50" height="50"
         data-toggle="tooltip" data-placement="top" title="¡Danos tu opinión!"></a> 

      <a href={toolsMenu.ponteEnLineaUrl} target="_blank"> <img src="img/enlinea.svg" alt="ponte-en-linea" width="50" height="50" data-toggle="tooltip" data-placement="top" title="Ponte en líne@"></a> 
      <a href={toolsMenu.logoutUrl}> <img src="img/salir.svg" alt="cerrar-sesion" width="50" height="50" data-toggle="tooltip" data-placement="top" title="Cerrar sesión"></a> 
    </div>
    <!-- fin tools -->

    <!-- modal tools -->
    <!-- Modal foro -->
    <div class="modal fade" id="foro" tabindex="-1" aria-labelledby="foro-Label" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-6" id="foro-Label">Foro</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <div class="embed-iframe-act">
              <iframe src={toolsMenu.foroUrl}></iframe>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Modal evalua -->
    <div class="modal fade" id="evalua" tabindex="-1" aria-labelledby="evalua-Label" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-6" id="evalua-Label">Evalua</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <div class="embed-iframe-act">
              <iframe src={toolsMenu.evaluaUrl}></iframe>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cerrar</button>
          </div>
        </div>
      </div>
    </div>
  </Fragment>
)}

<!-- ************* TERMINA FOOTER ************** -->
