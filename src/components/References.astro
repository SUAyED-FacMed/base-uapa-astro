---
import { REFERENCES_CONFIG, type ReferenceCategory } from '../config/references-config.ts';
import { UAPA_CONFIG } from '../config/uapa-config.ts';
import { formatAuthors, formatAuthorsForCitation } from '../config/format-utils.ts';

export interface Props {
  // Nueva estructura flexible
  basicSections?: ReferenceCategory[];
  complementarySections?: ReferenceCategory[];
  
  // Compatibilidad hacia atrás
  basicReferences?: string[];
  complementaryReferences?: string[];
  
  // Control de visualización
  showBasic?: boolean;
  showComplementary?: boolean;
  basicSectionTitle?: string;
  complementarySectionTitle?: string;
  
  // Configuración de cita
  uapaTitle?: string;
  uapaAuthors?: string;
  uapaUrl?: string;
}

const { 
  // Extraer props primero
  basicSections: propBasicSections,
  complementarySections: propComplementarySections,
  basicReferences,
  complementaryReferences,
  showBasic = true,
  showComplementary = true,
  basicSectionTitle = "Básicas",
  complementarySectionTitle = "Complementarias",
  uapaTitle = UAPA_CONFIG.title,
  uapaAuthors = formatAuthorsForCitation(UAPA_CONFIG.authors),
  uapaUrl = "(Vínculo)"
} = Astro.props;

// Determinar qué estructura usar (nueva estructura flexible vs legacy)
const basicSections = propBasicSections || 
  REFERENCES_CONFIG.basic?.sections || 
  (basicReferences ? [{ title: "Bibliografía", references: basicReferences }] : 
   [{ title: "Bibliografía", references: REFERENCES_CONFIG.basicLegacy || [] }]);
   
const complementarySections = propComplementarySections || 
  REFERENCES_CONFIG.complementary?.sections || 
  (complementaryReferences ? [{ title: "Bibliografía", references: complementaryReferences }] : 
   [{ title: "Documentos electrónicos", references: REFERENCES_CONFIG.complementaryLegacy || [] }]);

// Verificar si hay contenido real
const hasBasicContent = basicSections.some(section => section.references && section.references.length > 0);
const hasComplementaryContent = complementarySections.some(section => section.references && section.references.length > 0);
---

<!-- ************* INICIA REFERENCIAS ************** -->
<section id="fuentes-info" class="wrapper-section">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-12">
        <!-- contenido -->
        <h2>
          <!--<i class="icon-fuentes-icon icono me-2" aria-hidden="true"></i>-->
          <!-- cuando el icono es una fuente -->
          <img class="me-2 img-fluid icono-svg" src="img/ico_fuentes.svg" alt="">
          <!-- cuando el icono es una imagen -->
          Fuentes de información
        </h2>

        <!-- Referencias Básicas -->
        {showBasic && hasBasicContent && (
          <>
            <h3>{basicSectionTitle}</h3>
            {basicSections.map(section => (
              section.references && section.references.length > 0 && (
                <div class="reference-section">
                  <h4>{section.title}</h4>
                  <ul>
                    {section.references.map(ref => (
                      <li set:html={ref}></li>
                    ))}
                  </ul>
                </div>
              )
            ))}
          </>
        )}

        <!-- Referencias Complementarias -->
        {showComplementary && hasComplementaryContent && (
          <>
            <h3>{complementarySectionTitle}</h3>
            {complementarySections.map(section => (
              section.references && section.references.length > 0 && (
                <div class="reference-section">
                  <h4>{section.title}</h4>
                  <ul>
                    {section.references.map(ref => (
                      <li set:html={ref}></li>
                    ))}
                  </ul>
                </div>
              )
            ))}
          </>
        )}      

        <!-- como citar -->
        <h3 class="envolv"><i class="icon-pen me-2" aria-hidden="true"></i><span>Cómo citar</span></h3>
        <p>{uapaAuthors} ({UAPA_CONFIG.year}). {uapaTitle}. <em>Unidades de Apoyo para el Aprendizaje</em>.
          CUAED/Facultad de Medicina-UNAM. {uapaUrl}</p>

        <!-- termina contenido -->
      </div>
    </div>
  </div>
</section>
<!-- ************* TERMINAN REFERENCIAS ************** -->
