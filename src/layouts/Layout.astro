---
import ResourceLoader from "../components/ResourceLoader.astro";
import Footer from "../components/Footer.astro";
import { UAPA_CONFIG, formatAuthors } from "../config/uapa-config.ts";

// Importar estilos personalizados como URL para asegurar que sea un archivo separado
import personalizadoUrl from "../styles/personalizado.css?url";

export interface Props {
  title: string;
  description?: string;
  keywords?: string;
  author?: string;
  resources?: string[]; // Recursos a cargar
}

const {
  title,
  description = UAPA_CONFIG.description,
  keywords = UAPA_CONFIG.keywords,
  author = formatAuthors.full,
  resources = [],
} = Astro.props;

// Añadir KaTeX a los recursos si está habilitado en la configuración
const finalResources =
  UAPA_CONFIG.enableLatex && !resources.includes("katex")
    ? [...resources, "katex"]
    : resources;
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- METADATOS DE UAPA -->
    <meta name="description" content={description} />
    <meta name="keywords" content={keywords} />
    <meta name="author" content={author} />

    <title>{title}</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />

    <!-- PLANTILLA -->
    <link rel="stylesheet" href="css/bootstrap5_3/bootstrap-reboot.css" />
    <link rel="stylesheet" href="css/bootstrap5_3/bootstrap.css" />
    <link rel="stylesheet" href="css/layout/layout.css" />
    <link rel="stylesheet" href="css/layout/medias.css" />
    <!-- estilos de color general -->
    <link rel="stylesheet" href="css/colores/color_general.css" />
    <!-- animación de imágenes -->
    <link href="css/layout/aos.css" rel="stylesheet" />

    <!-- FONTS GENERAL-->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Raleway:400,500,700"
      rel="stylesheet"
    />
    <!-- fonts para iconos -->
    <link rel="stylesheet" href="./css/font.css" />
    <!-- fonts para hero -->
    <link
      href="https://fonts.googleapis.com/css?family=Muli"
      rel="stylesheet"
    />

    <!-- ESTILOS DE CONTENIDO -->
    <link rel="stylesheet" href="./css/main.css" />
    <link rel="stylesheet" href={personalizadoUrl.replace(/^\//, "")} />

    <!-- RECURSOS DINÁMICOS -->
    <ResourceLoader resources={finalResources} />
  </head>

  <body id="contenido">
    <slot />

    <!-- Botón ir arriba -->
    <i class="ir-arriba fas fa-chevron-up fa-2x"></i>

    <!-- ************ SCRIPTS ************ -->
    <script src="./js/bootstrap.bundle.js" is:inline></script>

    <!-- AOS animations -->
    <script src="./js/aos/aos.js" is:inline></script>
    <script src="./js/aos/aos_inicialize.js" is:inline></script>

    <!-- botón ir arriba -->
    <script src="./js/ir_arriba.js" is:inline></script>

    <!-- ************ SCRIPTS DE RECURSOS ************ -->
    <!-- Los scripts de recursos se cargan dinámicamente via ResourceLoader -->

    <script is:inline>
      document.addEventListener("DOMContentLoaded", function () {
        // Bootstrap tooltips initialization
        if (typeof bootstrap !== "undefined") {
          const tooltipTriggerList = document.querySelectorAll(
            '[data-bs-toggle="tooltip"]',
          );
          const tooltipList = [...tooltipTriggerList].map(
            (tooltipTriggerEl) => new bootstrap.Tooltip(tooltipTriggerEl),
          );
        }

        // Navbar collapse on mobile
        let t = document.querySelector(".navbar-collapse");
        if (t) {
          t.addEventListener("click", function (a) {
            if (a.target && a.target.tagName === "A") {
              const target = a.target;
              if (
                target.classList.contains("dropdown-item") ||
                (target.classList.contains("nav-link") &&
                  !target.classList.contains("dropdown-toggle"))
              ) {
                t.classList.remove("show");
              }
            }
          });
        }
      });
    </script>
    <!-- Footer -->
    <Footer
      uapaTitle={UAPA_CONFIG.title}
      authorName={formatAuthors.withAnd(UAPA_CONFIG.authors)}
    />
  </body>
</html>
